<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>打BOSS - Idle Game</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- ========== 战斗Tab ========== -->
        <div id="tab-battle" class="tab-page active">
            <div class="battle-layout">
                <!-- 左栏: Boss + 金币 + 设置 -->
                <div class="battle-left">
                    <!-- Boss区域 -->
                    <div class="boss-section">
                        <div class="boss-level">
                            Boss Lv.<span id="boss-level">1</span>
                            <span id="prestige-badge" class="prestige-badge" style="display:none">🎖️ 第<span id="prestige-count">2</span>周目</span>
                        </div>
                        <div class="boss-sprite" id="boss-sprite">
                            <div class="boss-icon" id="boss-icon">👹</div>
                            <div id="damage-container"></div>
                        </div>
                        <div class="boss-hp-container">
                            <div class="boss-hp-label"><span id="boss-hp-text">100 / 100</span></div>
                            <div class="pixel-progress">
                                <div class="pixel-progress-fill" id="boss-hp-bar" style="width: 100%"></div>
                            </div>
                        </div>
                    </div>

                    <!-- 金币统计栏 -->
                    <div class="stats-compact">
                        <div class="stat-compact">
                            <span class="stat-compact-label">💰</span>
                            <span class="stat-compact-value" id="gold-text">0</span>
                        </div>
                    </div>

                    <!-- 设置 -->
                    <div class="settings-section">
                        <div class="setting-item">
                            <span class="setting-label">显示伤害飘字</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="toggle-damage-numbers" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <span class="setting-label">显示技能飘字</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="toggle-skill-numbers" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- 重置 / 统计 -->
                    <div class="reset-section">
                        <button class="stats-btn" id="btn-stats">📊 战况统计</button>
                        <button class="stats-btn simulator-link" id="btn-simulator">🧮 升级模拟器</button>
                        <button class="reset-btn" id="btn-reset">🔄 重新开始游戏</button>
                    </div>

                    <!-- 兑换码 -->
                    <div class="redeem-section">
                        <div class="redeem-title">兑换码</div>
                        <div class="redeem-input-group">
                            <input class="redeem-input" id="redeem-input" placeholder="输入兑换码">
                            <button class="redeem-btn" id="btn-redeem">兑换</button>
                        </div>
                    </div>
                </div>

                <!-- 右栏: 佣兵列表 -->
                <div class="battle-right">
                    <div class="merc-list-wrapper">
                        <div class="mercenaries-scroll" id="battle-merc-list"></div>
                        <div class="merc-skill-overlay" id="merc-skill-overlay"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== 佣兵Tab ========== -->
        <div id="tab-mercenaries" class="tab-page">
            <div class="manage-container">
                <div class="page-header">
                    <span class="page-title">佣兵管理</span>
                    <div class="gold-display">
                        <span class="gold-icon">💰</span>
                        <span class="gold-value" id="merc-gold-text">0</span>
                    </div>
                </div>
                <div class="manage-scroll-full" id="manage-merc-list"></div>
            </div>
        </div>

        <!-- ========== 圣物Tab ========== -->
        <div id="tab-relics" class="tab-page">
            <div class="relic-container">
                <div class="header">
                    <span class="title">📜 我的圣物库</span>
                    <div class="subtitle">通关更高周目以获得更多圣物</div>
                </div>
                <div class="bonus-card">
                    <div class="card-title">✨ 总属性加成</div>
                    <div class="bonus-grid">
                        <div class="bonus-item"><span class="label">⚔️ 伤害加成</span><span class="value" id="relic-damage">+0%</span></div>
                        <div class="bonus-item"><span class="label">🪙 金币收益</span><span class="value" id="relic-gold">+0%</span></div>
                        <div class="bonus-item"><span class="label">⚡ 进攻速度</span><span class="value" id="relic-speed">+0%</span></div>
                        <div class="bonus-item"><span class="label">📉 招募成本</span><span class="value" id="relic-cost">-0%</span></div>
                        <div class="bonus-item"><span class="label">🎯 暴击概率</span><span class="value" id="relic-crit-chance">+0%</span></div>
                        <div class="bonus-item"><span class="label">🔪 暴击伤害</span><span class="value" id="relic-crit-mult">+0%</span></div>
                    </div>
                </div>
                <div class="relic-list-scroll" id="relic-list"></div>
            </div>
        </div>

        <!-- ========== 底部Tab栏 ========== -->
        <div class="tab-bar">
            <div class="tab-bar-item active" data-tab="battle">⚔️ 战斗</div>
            <div class="tab-bar-item" data-tab="mercenaries">🛡️ 佣兵</div>
            <div class="tab-bar-item" data-tab="relics">📜 圣物</div>
        </div>
    </div>

    <!-- 离线收益弹窗 -->
    <div id="modal-offline" class="modal-overlay" style="display:none">
        <div class="modal-content pixel-card">
            <div class="modal-title">离线收益</div>
            <div class="modal-body">
                <p>离线时间: <span id="offline-time"></span></p>
                <p>总伤害: <span id="offline-damage"></span></p>
                <p>获得金币: <span id="offline-gold"></span></p>
                <p>击败Boss: <span id="offline-bosses"></span></p>
            </div>
            <button class="pixel-button" id="btn-close-offline">领取</button>
        </div>
    </div>

    <!-- 遗物选择弹窗 -->
    <div id="modal-relic" class="modal-overlay" style="display:none">
        <div class="modal-content pixel-card" style="width: 90%; max-height: 80vh;">
            <div class="modal-title">🏆 凯旋归来！请选择一件战利品</div>
            <div class="modal-body" id="relic-choices"></div>
            <div class="text-muted" style="text-align: center; font-size: 12px; margin-top: 10px;">提示：选择后将开启下一周目</div>
        </div>
    </div>

    <!-- 战况统计弹窗 -->
    <div id="modal-stats" class="modal-overlay" style="display:none">
        <div class="modal-content pixel-card" style="width: 92%; max-height: 85vh; overflow-y: auto;">
            <div class="modal-title">📉 战况统计</div>
            <div class="stats-table" id="stats-table-body"></div>
            <div class="total-stats">
                <span>总通关耗时:</span>
                <span class="total-val" id="total-time">0s</span>
            </div>
            <div class="section-divider"></div>
            <div class="modal-title" style="margin-top:8px;">⚔️ 伤害排行</div>
            <div class="damage-ranking" id="damage-ranking-body"></div>
            <button class="pixel-button" id="btn-close-stats">关闭</button>
        </div>
    </div>

    <!-- 升级模拟器弹窗 -->
    <div id="modal-simulator" class="modal-overlay" style="display:none">
        <div class="modal-content pixel-card sim-modal">
            <div class="sim-modal-header">
                <div class="modal-title" style="margin-bottom:0">🧮 升级模拟器</div>
                <button class="sim-close-btn" id="btn-close-sim">✕</button>
            </div>
            <div class="sim-modal-body">
                <div class="sim-controls">
                    <div class="sim-control-row">
                        <div class="sim-control-group">
                            <label>选择英雄</label>
                            <select id="sim-merc-select"></select>
                        </div>
                        <div class="sim-control-group">
                            <label>目标等级</label>
                            <input type="number" id="sim-target-level" value="100" min="2" max="500">
                        </div>
                    </div>
                    <div class="sim-control-row">
                        <div class="sim-control-group">
                            <label>升级策略</label>
                            <div class="sim-mode-tabs">
                                <button class="sim-mode-tab active" data-mode="damage">只升攻击</button>
                                <button class="sim-mode-tab" data-mode="interval">只升攻速</button>
                                <button class="sim-mode-tab" data-mode="alternate">交替升级</button>
                            </div>
                        </div>
                        <button class="pixel-button sim-run-btn" id="btn-run-sim">开始模拟</button>
                    </div>
                </div>
                <div class="sim-stats-cards" id="sim-stats-cards" style="display:none">
                    <div class="sim-stat-card"><div class="sim-stat-label">显示等级</div><div class="sim-stat-value level" id="sim-s-level">-</div><div class="sim-stat-sub" id="sim-s-level-detail"></div></div>
                    <div class="sim-stat-card"><div class="sim-stat-label">最终攻击力</div><div class="sim-stat-value damage" id="sim-s-damage">-</div><div class="sim-stat-sub" id="sim-s-damage-detail"></div></div>
                    <div class="sim-stat-card"><div class="sim-stat-label">攻击间隔</div><div class="sim-stat-value speed" id="sim-s-interval">-</div><div class="sim-stat-sub" id="sim-s-interval-detail"></div></div>
                    <div class="sim-stat-card"><div class="sim-stat-label">累计花费</div><div class="sim-stat-value gold" id="sim-s-gold">-</div><div class="sim-stat-sub" id="sim-s-gold-detail"></div></div>
                </div>
                <div class="sim-table-wrap" id="sim-table-wrap" style="display:none">
                    <div class="sim-table-top">
                        <span style="font-size:12px;color:var(--accent-color)">📋 逐级明细</span>
                        <button class="sim-export-btn" id="btn-sim-export">导出CSV</button>
                    </div>
                    <div class="sim-table-scroll">
                        <table class="sim-table">
                            <thead><tr><th>等级</th><th>类型</th><th>本次花费</th><th>累计花费</th><th>攻击力</th><th>攻击间隔</th><th class="sim-note-col">备注</th></tr></thead>
                            <tbody id="sim-tbody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast" style="display:none"></div>

    <script type="module" src="app.js"></script>
</body>
</html>
