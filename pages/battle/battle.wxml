<!-- pages/battle/battle.wxml -->
<view class="battle-container {{isSpeedBuffActive ? 'buff-speed' : ''}} {{isDamageBuffActive ? 'buff-damage' : ''}}">
  <!-- Bossä¿¡æ¯åŒºåŸŸ -->
  <view class="boss-section">
    <view class="boss-level">Boss Lv.{{boss.level}}</view>
    
    <!-- Bossç²¾çµ -->
    <view class="boss-sprite" bindtap="onTapBoss">
      <view class="boss-icon {{attacking ? 'shake' : ''}}">ğŸ‘¹</view>
      
      <!-- ä¼¤å®³æ•°å­—åŠ¨ç”» -->
      <view wx:for="{{damageNumbers}}" wx:key="id" class="damage-number {{item.type}}" 
            style="left: {{item.x}}rpx; top: {{item.y}}rpx; animation-delay: {{item.delay}}ms">
        {{item.damage}}
      </view>
    </view>
    
    <!-- Bossè¡€æ¡ -->
    <view class="boss-hp-container">
      <view class="boss-hp-label">
        <text>{{bossHpText}}</text>
      </view>
      <view class="pixel-progress">
        <view class="pixel-progress-fill" style="width: {{bossHpPercent}}%"></view>
      </view>
    </view>
  </view>
  
  <!-- ç´§å‡‘çš„ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="stats-compact">
    <view class="stat-compact">
      <text class="stat-compact-label">ğŸ’°</text>
      <text class="stat-compact-value">{{goldText}}</text>
    </view>
  </view>
  
  <!-- ä½£å…µåˆ—è¡¨ -->
  <scroll-view scroll-y class="mercenaries-scroll" style="max-height: 60vh;">
    <view class="mercenaries-section">
      
      <view wx:for="{{mercenaries}}" wx:key="id" class="merc-item">
        <view class="merc-left">
          <text class="merc-icon-small">{{item.icon}}</text>
          <view class="merc-info-compact">
            <text class="merc-name-small">{{item.name}}</text>
            <!-- <text class="merc-count">x{{item.count}}</text> ç§»é™¤æ•°é‡æ˜¾ç¤º -->
          </view>
        </view>
        
        <view class="merc-right">
          <!-- æœªé›‡ä½£æ˜¾ç¤ºDPSé¢„è§ˆ -->
          <view wx:if="{{!item.recruited}}" class="merc-dps-info">
            <text class="merc-dps-label">DPS:</text>
            <text class="merc-dps-value">{{item.dpsText}}</text>
          </view>

          <!-- å·²é›‡ä½£æ˜¾ç¤ºè¯¦ç»†å±æ€§ (Gridå¸ƒå±€ - 2è¡Œ) -->
          <view wx:else class="merc-stats-grid">
             <!-- ç¬¬ä¸€è¡Œ: æ”»å‡» + æ”»é€Ÿ -->
             <view class="stats-row-compact">
                <view class="stat-pill damage small">
                   <text class="stat-icon">âš”ï¸</text>
                   <text class="stat-val">{{item.damageText}}</text>
                   <!-- ç©ºé—´ä¸å¤Ÿæ—¶å¯ä»¥éšè—Lvï¼Œæˆ–è€…ç¼©å° -->
                   <!-- <text class="stat-lvl">Lv.{{item.damageLevel}}</text> -->
                </view>
                
                <view class="stat-pill speed small">
                   <text class="stat-icon">âš¡</text>
                   <text class="stat-val">{{item.intervalText}}s</text>
                </view>
             </view>

             <!-- ç¬¬äºŒè¡Œ: DPS -->
             <view class="stat-pill dps">
                <text class="stat-icon">ğŸ”¥</text>
                <text class="stat-val">DPS: {{item.dpsText}}</text>
             </view>
          </view>

          <!-- ä»…æœªé›‡ä½£æ—¶æ˜¾ç¤ºæ‹›å‹ŸæŒ‰é’® -->
          <button 
            wx:if="{{!item.recruited}}"
            class="merc-recruit-btn {{item.canAfford ? '' : 'disabled'}}" 
            bindtap="onRecruitMercenary" 
            data-id="{{item.id}}"
            disabled="{{!item.canAfford}}">
            {{item.costText}}
          </button>
        </view>
      </view>
    </view>
    
    <!-- é‡ç½®æ¸¸æˆæŒ‰é’® -->
    <view class="reset-section">
      <button class="reset-btn" bindtap="onResetGame">ğŸ”„ é‡æ–°å¼€å§‹æ¸¸æˆ</button>
    </view>
  </scroll-view>
</view>

<!-- ç¦»çº¿æ”¶ç›Šå¼¹çª— -->
<view wx:if="{{showOfflineModal}}" class="modal-overlay" bindtap="closeOfflineModal">
  <view class="modal-content pixel-card" catchtap="preventClose">
    <view class="modal-title">ç¦»çº¿æ”¶ç›Š</view>
    <view class="modal-body">
      <text>ç¦»çº¿æ—¶é—´: {{offlineTimeText}}</text>
      <text>è·å¾—é‡‘å¸: {{offlineGoldText}}</text>
      <text>å‡»è´¥Boss: {{offlineBossesText}}</text>
    </view>
    <button class="pixel-button" bindtap="closeOfflineModal">é¢†å–</button>
  </view>
</view>
