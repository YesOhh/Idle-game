<!-- pages/mercenaries/mercenaries.wxml -->
<view class="manage-container">
  <!-- ========== é¡µé¢æ ‡é¢˜ ========== -->
  <view class="page-header">
    <text class="page-title">ä½£å…µç®¡ç†</text>
    <view class="gold-display">
      <text class="gold-icon">ğŸ’°</text>
      <text class="gold-value">{{goldText}}</text>
    </view>
  </view>

  <!-- ========== ä½£å…µç®¡ç†å†…å®¹ ========== -->
  <scroll-view scroll-y class="manage-scroll-full" show-scrollbar="{{false}}" enhanced="{{true}}">
    <view wx:for="{{manageMercRows}}" wx:key="rowIndex" wx:for-item="row" class="merc-row-wrapper">
      <!-- è¯¥è¡Œçš„ä½£å…µå¡ç‰‡ -->
      <view class="merc-grid-row">
        <view wx:for="{{row.items}}" wx:key="id" wx:for-item="merc"
              class="merc-grid-item {{merc.recruited ? 'recruited' : 'not-recruited'}} {{selectedMercId === merc.id ? 'selected' : ''}}"
              bindtap="onSelectMerc" data-id="{{merc.id}}">
          <view class="merc-grid-icon">{{merc.icon}}</view>
          <view class="merc-grid-name">{{merc.name}}</view>
        </view>
      </view>

      <!-- å¦‚æœé€‰ä¸­çš„ä½£å…µåœ¨è¿™ä¸€è¡Œï¼Œæ˜¾ç¤ºè¯¦æƒ… -->
      <view wx:if="{{selectedRowIndex === row.rowIndex && selectedMerc}}" class="merc-detail-panel">
        <view class="detail-header">
          <text class="detail-name">{{selectedMerc.icon}} {{selectedMerc.name}}</text>
        </view>
        <view class="detail-desc">{{selectedMerc.description}}</view>
        <view class="detail-stats">
          <view class="detail-stat">
            <text class="detail-label">æ”»å‡»åŠ›ï¼š</text>
            <text class="detail-value">{{selectedMerc.currentDamageText}}</text>
          </view>
          <view class="detail-stat">
            <text class="detail-label">æ”»å‡»é—´éš”ï¼š</text>
            <text class="detail-value">{{selectedMerc.currentInterval}}</text>
          </view>
        </view>

        <!-- æŠ€èƒ½æ˜¾ç¤º -->
        <view wx:if="{{selectedMerc.skillInfo}}" class="detail-skill">
          <view class="skill-detail-header">
            <text class="skill-name {{selectedMerc.skillInfo.isUnlocked ? 'unlocked' : 'locked'}}">{{selectedMerc.skillInfo.shortName}}</text>
            <text wx:if="{{selectedMerc.recruited && !selectedMerc.skillInfo.isUnlocked}}" class="skill-unlock-condition">{{selectedMerc.skillInfo.unlockCondition}}</text>
          </view>
          <view wx:if="{{selectedMerc.recruited}}" class="skill-detail-desc">{{selectedMerc.skillInfo.desc}}</view>
        </view>

        <!-- é›‡ä½£è´¹ç”¨ -->
        <view wx:if="{{!selectedMerc.recruited}}" class="detail-cost">
          <text>é›‡ä½£èŠ±è´¹ï¼š</text>
          <view class="cost-row">
            <text>ğŸ’° {{selectedMerc.recruitCostText}}</text>
          </view>
        </view>

        <!-- æ“ä½œæŒ‰é’® -->
        <view class="detail-actions">
          <button
            wx:if="{{!selectedMerc.recruited}}"
            class="action-btn recruit-btn {{selectedMerc.canAffordRecruit ? '' : 'disabled'}}"
            bindtap="onRecruitMercenary"
            data-id="{{selectedMerc.id}}"
            disabled="{{!selectedMerc.canAffordRecruit}}">
            é›‡ä½£
          </button>
          <view wx:else class="action-btn hired-btn">
            å·²é›‡ä½£
          </view>
        </view>
      </view>
    </view>

    <view wx:if="{{manageMercenaries.length === 0}}" class="empty-state">
      <text>æš‚æ— ä½£å…µæ•°æ®</text>
    </view>
  </scroll-view>
</view>
